---
// Video card component
import type { Video } from '../data/videos';

interface Props {
  video: Video;
}

const { video } = Astro.props;

// Function to extract YouTube video ID from various YouTube URL formats
function getYouTubeVideoId(url: string): string | null {
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\?\/\s]+)/,
    /youtube\.com\/watch\?.*v=([^&\?\/\s]+)/
  ];
  
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match && match[1]) {
      return match[1];
    }
  }
  return null;
}

// Function to extract Vimeo video ID
function getVimeoVideoId(url: string): string | null {
  const match = url.match(/vimeo\.com\/(\d+)/);
  return match ? match[1] : null;
}

// Detect platform and get appropriate thumbnail
const isVimeo = video.youtubeUrl.includes('vimeo.com');
const isYouTube = video.youtubeUrl.includes('youtube.com') || video.youtubeUrl.includes('youtu.be');

let thumbnailUrl = video.thumbnailUrl || '';
let platform = 'Vimeo';

if (!thumbnailUrl) {
  if (isYouTube) {
    const videoId = getYouTubeVideoId(video.youtubeUrl);
    thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : '';
    platform = 'YouTube';
  } else if (isVimeo) {
    const vimeoId = getVimeoVideoId(video.youtubeUrl);
    // For Vimeo, we need to fetch thumbnail via API or use manual thumbnails
    // Using a placeholder for now - users should add manual thumbnailUrl
    thumbnailUrl = '';
    platform = 'Vimeo';
  }
}
---

<div class="card">
  <a href={video.youtubeUrl} target="_blank" rel="noopener noreferrer" class="thumbnail-link">
    <div class="card-thumbnail">
      {thumbnailUrl ? (
        <>
          <img src={thumbnailUrl} alt={video.title} loading="lazy" />
          <div class="play-overlay">
            <svg class="play-icon" viewBox="0 0 24 24" fill="white">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </div>
        </>
      ) : (
        <span>ðŸŽ¬</span>
      )}
    </div>
  </a>
  <h3 class="card-title">{video.title}</h3>
  <p class="card-meta">{video.year} â€¢ {video.role}</p>
  <p class="card-description">{video.description}</p>
  <div class="card-actions">
    <a href={video.youtubeUrl} target="_blank" rel="noopener noreferrer" class="btn btn-small">
      Watch on {platform}
    </a>
  </div>
</div>

<style>
  .thumbnail-link {
    text-decoration: none;
    display: block;
    position: relative;
  }

  .card-thumbnail {
    position: relative;
    overflow: hidden;
  }

  .card-thumbnail img {
    transition: transform 0.3s ease;
  }

  .thumbnail-link:hover .card-thumbnail img {
    transform: scale(1.05);
  }

  .play-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background-color: rgba(200, 125, 92, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    pointer-events: none;
  }

  .thumbnail-link:hover .play-overlay {
    background-color: rgba(182, 109, 77, 0.95);
    transform: translate(-50%, -50%) scale(1.1);
  }

  .play-icon {
    width: 28px;
    height: 28px;
    margin-left: 4px;
  }
</style>
